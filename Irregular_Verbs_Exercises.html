<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>不规则动词练习</title>
  <style>
    :root {
      --bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --card: rgba(255, 255, 255, 0.95);
      --accent: #667eea;
      --ok: #10b981;
      --bad: #ef4444;
      --muted: #6b7280;
      --text: #1f2937;
      --border: #e5e7eb;
      --shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    html, body {
      height: 100%;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.6;
    }
    
    body {
      background: var(--bg);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      min-height: 100vh;
      color: var(--text);
    }
    
    .wrap {
      width: 100%;
      max-width: 800px;
      animation: fadeIn 0.6s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 12px;
    }
    
    h1 {
      font-size: 24px;
      font-weight: 700;
      color: white;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    .stats {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }
    
    .stat-item {
      background: rgba(255, 255, 255, 0.2);
      padding: 8px 16px;
      border-radius: 20px;
      color: white;
      font-size: 14px;
      font-weight: 500;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    .card {
      background: var(--card);
      border-radius: 20px;
      padding: 24px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      position: relative;
      overflow: hidden;
    }
    
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #667eea, #764ba2);
    }
    
    .progress-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 12px;
    }
    
    .progress-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: var(--muted);
    }
    
    .progress-number {
      font-weight: 600;
      color: var(--accent);
    }
    
    .accuracy-display {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 14px;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }
    
    .verb-section {
      text-align: center;
      margin: 24px 0;
      padding: 20px;
      background: linear-gradient(135deg, #f8fafc, #f1f5f9);
      border-radius: 16px;
      border: 1px solid var(--border);
    }
    
    .verb-large {
      font-size: 48px;
      font-weight: 800;
      letter-spacing: -0.5px;
      margin: 12px 0;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .meaning {
      font-size: 18px;
      color: var(--muted);
      margin-top: 6px;
      font-weight: 500;
    }
    
    .hint {
      font-size: 14px;
      color: var(--accent);
      margin-top: 6px;
      font-style: italic;
    }
    
    .verb-selector {
      margin: 20px 0;
    }
    
    select {
      width: 100%;
      padding: 16px;
      border-radius: 12px;
      border: 2px solid var(--border);
      font-size: 16px;
      background: white;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .input-group {
      margin: 18px 0;
    }
    
    .input-label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: var(--text);
      font-size: 14px;
    }
    
    .input-field {
      width: 100%;
      padding: 16px;
      border-radius: 12px;
      border: 2px solid var(--border);
      font-size: 16px;
      transition: all 0.3s ease;
      background: white;
    }
    
    .input-field:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      transform: translateY(-2px);
    }
    
    .input-field.ok {
      border-color: var(--ok);
      background: rgba(16, 185, 129, 0.05);
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
    }
    
    .input-field.bad {
      border-color: var(--bad);
      background: rgba(239, 68, 68, 0.05);
      box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
    }
    
    .controls {
      display: flex;
      gap: 12px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    
    button {
      padding: 14px 20px;
      border-radius: 12px;
      border: none;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      flex: 1;
      min-width: 120px;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    button.primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }
    
    button.secondary {
      background: white;
      color: var(--text);
      border: 2px solid var(--border);
      font-weight: 600;
    }
    
    button.secondary:hover {
      border-color: var(--accent);
      color: var(--accent);
      background: #f8fafc;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
    }
    
    button.secondary:active {
      background: #f1f5f9;
      transform: translateY(0);
    }
    
    .status {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 16px;
      padding: 14px;
      background: #f8fafc;
      border-radius: 12px;
      border: 1px solid var(--border);
    }
    
    .status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .status-message {
      font-size: 14px;
      font-weight: 500;
    }
    
    .progress-bar {
      height: 8px;
      background: #e5e7eb;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 12px;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea, #764ba2);
      transition: width 0.5s ease;
      border-radius: 4px;
    }
    
    .footer {
      margin-top: 20px;
      text-align: center;
      color: rgba(255, 255, 255, 0.8);
      font-size: 14px;
    }
    
    /* 错误单词复习区域样式 */
    .error-review-section {
      background: linear-gradient(135deg, #fef2f2, #fecaca);
      border: 2px solid #fca5a5;
      border-radius: 16px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.1);
    }
    
    .error-review-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .error-review-header h3 {
      margin: 0;
      color: #dc2626;
      font-size: 16px;
      font-weight: 700;
    }
    
    .error-count {
      background: #dc2626;
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 11px; /* 从12px改为11px */
      font-weight: 600;
    }
    
    .error-words-list {
      max-height: 200px;
      overflow-y: auto;
      margin-bottom: 16px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 8px;
      border: 1px solid #fca5a5;
    }
    
    .error-word-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      margin-bottom: 8px;
      background: white;
      border-radius: 8px;
      border: 1px solid #fecaca;
      transition: all 0.3s ease;
    }
    
    .error-word-item:hover {
      border-color: #fca5a5;
      box-shadow: 0 2px 8px rgba(239, 68, 68, 0.15);
    }
    
    .error-word-info {
      flex: 1;
    }
    
    .error-word-base {
      font-weight: 600;
      color: #dc2626;
      font-size: 16px;
    }
    
    .error-word-meaning {
      font-size: 12px;
      color: #6b7280;
      margin-top: 2px;
    }
    
    .error-word-remove {
      background: #dc2626;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .error-word-remove:hover {
      background: #b91c1c;
      transform: scale(1.05);
    }
    
    .error-review-controls {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    
    .error-review-controls button {
      flex: 1;
      min-width: 120px;
    }
    
    /* 小屏幕上的按钮布局 */
    @media (max-width: 480px) {
      .error-review-controls {
        flex-direction: column;
        gap: 8px;
      }
      
      .error-review-controls button {
        min-width: auto;
        width: 100%;
      }
    }
    
    /* 返回按钮特殊样式 */
    #backToNormalBtn {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      border: none;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    #backToNormalBtn:hover {
      background: linear-gradient(135deg, #059669, #047857);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }
    
    #backToNormalBtn:active {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(16, 185, 129, 0.2);
    }
    
    /* 响应式设计 */
    @media (max-width: 768px) {
      .wrap {
        max-width: 100%;
      }
      
      .card {
        padding: 20px 16px;
        margin: 0 4px;
      }
      
      .verb-large {
        font-size: 32px;
        margin: 12px 0;
      }
      
      .controls {
        flex-direction: column;
        gap: 8px;
      }
      
      button {
        min-width: auto;
        padding: 12px 16px;
        font-size: 14px;
      }
      
      .stats {
        flex-direction: column;
        align-items: stretch;
      }
      
      .progress-info {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
        margin-bottom: 16px;
      }
      
      .verb-section {
        margin: 20px 0;
        padding: 16px;
      }
      
      .input-group {
        margin: 16px 0;
      }
      
      .status {
        margin-top: 16px;
        padding: 12px;
      }
    }
    
    @media (max-width: 480px) {
      body {
        padding: 8px;
      }
      
      .card {
        padding: 16px 12px;
        margin: 0 2px;
      }
      
      .verb-large {
        font-size: 28px;
        margin: 8px 0;
      }
      
      .meaning {
        font-size: 16px;
        margin-top: 6px;
      }
      
      .verb-section {
        padding: 16px 12px;
        margin: 16px 0;
      }
      
      .input-field {
        padding: 12px;
        font-size: 16px;
      }
      
      select {
        padding: 12px;
        font-size: 16px;
      }
      
      .progress-info {
        gap: 8px;
        margin-bottom: 12px;
      }
      
      .progress-item {
        font-size: 12px;
      }
      
      .accuracy-display {
        font-size: 12px;
        padding: 6px 10px;
      }
      
      .input-group {
        margin: 12px 0;
      }
      
      .input-label {
        font-size: 13px;
        margin-bottom: 6px;
      }
      
      .controls {
        margin-top: 16px;
        gap: 6px;
      }
      
      .status {
        margin-top: 12px;
        padding: 10px;
      }
      
      .status-message {
        font-size: 13px;
      }
      
      .progress-bar {
        margin-top: 12px;
      }
      
      .footer {
        margin-top: 16px;
        font-size: 12px;
      }
    }
    
    /* 超小屏幕适配 */
    @media (max-width: 360px) {
      body {
        padding: 6px;
      }
      
      .card {
        padding: 12px 8px;
        margin: 0;
      }
      
      .verb-large {
        font-size: 24px;
        margin: 6px 0;
      }
      
      .meaning {
        font-size: 14px;
        margin-top: 4px;
      }
      
      .progress-info {
        gap: 6px;
        margin-bottom: 10px;
      }
      
      .progress-item {
        font-size: 11px;
      }
      
      .accuracy-display {
        font-size: 11px;
        padding: 4px 8px;
      }
      
      button {
        padding: 10px 12px;
        font-size: 13px;
      }
      
      .input-field, select {
        padding: 10px;
        font-size: 16px;
      }
      
      .verb-section {
        padding: 12px 8px;
        margin: 12px 0;
      }
      
      .input-group {
        margin: 10px 0;
      }
      
      .input-label {
        font-size: 12px;
        margin-bottom: 4px;
      }
      
      .controls {
        margin-top: 12px;
        gap: 4px;
      }
      
      .status {
        margin-top: 10px;
        padding: 8px;
      }
      
      .status-message {
        font-size: 12px;
      }
      
      .progress-bar {
        margin-top: 10px;
      }
      
      .footer {
        margin-top: 12px;
        font-size: 11px;
      }
    }
    
    /* 横屏模式优化 */
    @media (orientation: landscape) and (max-height: 600px) {
      body {
        padding: 8px;
      }
      
      .card {
        padding: 20px;
      }
      
      .verb-section {
        margin: 20px 0;
        padding: 16px;
      }
      
      .verb-large {
        font-size: 32px;
        margin: 12px 0;
      }
      
      .input-group {
        margin: 16px 0;
      }
      
      .controls {
        margin-top: 16px;
      }
      
      .status {
        margin-top: 16px;
        padding: 12px;
      }
    }
    
    /* 大屏幕优化 */
    @media (min-width: 1200px) {
      .wrap {
        max-width: 1000px;
      }
      
      .card {
        padding: 40px;
      }
      
      .verb-large {
        font-size: 56px;
      }
      
      .meaning {
        font-size: 20px;
      }
      
      .input-field, select {
        padding: 18px;
        font-size: 18px;
      }
      
      button {
        padding: 16px 24px;
        font-size: 18px;
      }
    }
    
    /* 触摸设备优化 */
    @media (hover: none) and (pointer: coarse) {
      button {
        min-height: 44px; /* 触摸友好的最小高度 */
      }
      
      .input-field, select {
        min-height: 44px;
      }
      
      .verb-selector {
        margin: 20px 0;
      }
      
      select {
        font-size: 16px; /* 防止iOS缩放 */
      }
    }
    
    /* 紧凑布局样式 */
    .compact-layout .card {
      padding: 20px;
    }
    
    .compact-layout .verb-section {
      margin: 20px 0;
      padding: 16px;
    }
    
    .compact-layout .verb-large {
      margin: 12px 0;
    }
    
    .compact-layout .input-group {
      margin: 16px 0;
    }
    
    .compact-layout .controls {
      margin-top: 16px;
    }
    
    .compact-layout .status {
      margin-top: 16px;
      padding: 12px;
    }
    
    /* 超紧凑模式 - 确保在手机上完整显示 */
    .ultra-compact .card {
      padding: 12px;
    }
    
    .ultra-compact .progress-info {
      gap: 6px;
      margin-bottom: 8px;
    }
    
    .ultra-compact .progress-item {
      font-size: 11px;
    }
    
    .ultra-compact .accuracy-display {
      font-size: 11px;
      padding: 4px 8px;
    }
    
    .ultra-compact .verb-section {
      margin: 12px 0;
      padding: 12px;
    }
    
    .ultra-compact .verb-large {
      font-size: 24px;
      margin: 6px 0;
    }
    
    .ultra-compact .meaning {
      font-size: 14px;
      margin-top: 4px;
    }
    
    .ultra-compact .verb-selector {
      margin: 16px 0;
    }
    
    .ultra-compact .input-group {
      margin: 10px 0;
    }
    
    .ultra-compact .input-label {
      font-size: 12px;
      margin-bottom: 4px;
    }
    
    .ultra-compact .input-field,
    .ultra-compact select {
      padding: 10px;
      font-size: 16px;
    }
    
    .ultra-compact .controls {
      margin-top: 12px;
      gap: 6px;
    }
    
    .ultra-compact button {
      padding: 10px 12px;
      font-size: 13px;
    }
    
    .ultra-compact .status {
      margin-top: 10px;
      padding: 8px;
    }
    
    .ultra-compact .status-message {
      font-size: 12px;
    }
    
    .ultra-compact .progress-bar {
      margin-top: 8px;
    }
    
    .ultra-compact .footer {
      margin-top: 10px;
      font-size: 11px;
    }
    
    /* 触摸设备样式 */
    .touch-device button {
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    
    .touch-device .input-field,
    .touch-device select {
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    
    .touch-device .verb-selector {
      touch-action: manipulation;
    }
    
    /* 深色模式下的触摸设备优化 */
    @media (prefers-color-scheme: dark) {
      .touch-device button.secondary {
        -webkit-tap-highlight-color: rgba(156, 163, 175, 0.3);
      }
      
      .touch-device button.secondary:active {
        background: #374151;
        transform: scale(0.98);
        transition: all 0.1s ease;
      }
    }
    
    /* 高分辨率屏幕优化 */
    @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
      .card::before {
        height: 2px;
      }
      
      .progress-bar {
        height: 4px;
      }
      
      .status-dot {
        width: 8px;
        height: 8px;
      }
    }
    
    /* 减少动画偏好设置 */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
      
      .wrap {
        animation: none;
      }
      
      button:hover {
        transform: none;
      }
      
      .input-field:focus {
        transform: none;
      }
    }
    
    /* 高对比度模式支持 */
    @media (prefers-contrast: high) {
      :root {
        --border: #000000;
        --text: #000000;
        --muted: #000000;
      }
      
      .card {
        border: 2px solid var(--border);
      }
      
      .input-field {
        border-width: 2px;
      }
      
      button {
        border: 2px solid var(--border);
      }
    }
    
    /* 打印样式 */
    @media print {
      body {
        background: white;
        color: black;
      }
      
      .card {
        box-shadow: none;
        border: 1px solid #000;
      }
      
      .controls, .status, .progress-bar {
        display: none;
      }
      
      .verb-section {
        background: white;
        border: 1px solid #000;
      }
    }
    
    /* 深色模式支持 */
    @media (prefers-color-scheme: dark) {
      :root {
        --card: rgba(31, 41, 55, 0.95);
        --text: #f9fafb;
        --border: #374151;
        --bg: linear-gradient(135deg, #1f2937 0%, #111827 100%);
      }
      
      .verb-section {
        background: linear-gradient(135deg, #374151, #4b5563);
        border-color: #4b5563;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      }
      
      /* 深色模式下的动词原型优化 */
      .verb-large {
        background: linear-gradient(135deg, #ffffff, #e5e7eb);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        filter: drop-shadow(0 2px 4px rgba(255, 255, 255, 0.1));
        /* 备用方案：如果渐变不支持，使用纯白色 */
        color: #ffffff;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }
      
      /* 确保深色模式下动词原型清晰可见 */
      @media (prefers-color-scheme: dark) and (max-width: 768px) {
        .verb-large {
          background: none;
          -webkit-background-clip: unset;
          -webkit-text-fill-color: unset;
          background-clip: unset;
          color: #ffffff;
          text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
          font-weight: 900;
        }
      }
      
      .input-field, select {
        background: #374151;
        color: #f9fafb;
        border-color: #4b7280;
      }
      
      .status {
        background: #374151;
        border-color: #4b5563;
      }
      
      /* 深色模式下的按钮优化 */
      button.secondary {
        background: #4b5563;
        color: #ffffff;
        border-color: #6b7280;
        font-weight: 600;
      }
      
      button.secondary:hover {
        background: #6b7280;
        border-color: #9ca3af;
        color: #ffffff;
        box-shadow: 0 4px 12px rgba(156, 163, 175, 0.3);
      }
      
      button.secondary:active {
        background: #374151;
        transform: translateY(0);
      }
      
      /* 深色模式下的输入标签 */
      .input-label {
        color: #f9fafb;
        font-weight: 600;
      }
      
      /* 深色模式下的进度信息 */
      .progress-item {
        color: #d1d5db;
        font-weight: 500;
      }
      
      .progress-number {
        color: #60a5fa;
        font-weight: 700;
      }
      
      /* 深色模式下的状态信息 */
      .status-message {
        color: #f9fafb;
        font-weight: 500;
      }
      
      /* 深色模式下的提示文字 */
      .hint {
        color: #60a5fa;
      }
      
      /* 深色模式下的含义文字 */
      .meaning {
        color: #d1d5db;
        font-weight: 500;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
      }
      
      /* 深色模式下的错误复习区域 */
      .error-review-section {
        background: linear-gradient(135deg, #450a0a, #7f1d1d);
        border-color: #dc2626;
      }
      
      .error-review-header h3 {
        color: #ffffff; /* 深色模式下使用白色，确保清晰可见 */
        font-size: 16px; /* 与浅色模式保持一致 */
      }
      
      .error-words-list {
        background: rgba(31, 41, 55, 0.8);
        border-color: #dc2626;
      }
      
      .error-word-item {
        background: #374151;
        border-color: #7f1d1d;
        color: #f9fafb;
      }
      
      .error-word-item:hover {
        border-color: #dc2626;
        background: #4b5563;
      }
      
      .error-word-base {
        color: #fca5a5;
      }
      
      .error-word-meaning {
        color: #9ca3af;
      }
      
      /* 深色模式下的返回按钮 */
      #backToNormalBtn {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        border: none;
        font-weight: 600;
        transition: all 0.3s ease;
      }
      
      #backToNormalBtn:hover {
        background: linear-gradient(135deg, #059669, #047857);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
      }
      
      #backToNormalBtn:active {
        transform: translateY(0);
        box-shadow: 0 2px 8px rgba(16, 185, 129, 0.2);
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="card">
      <div class="progress-info">
        <div class="progress-item">
          序号 <span class="progress-number" id="index">1</span> / 150
        </div>
        <div class="progress-item">
          正确 <span class="progress-number" id="correctCount">0</span>
        </div>
        <div class="progress-item">
          错误 <span class="progress-number" id="wrongCount">0</span>
        </div>
        <div class="accuracy-display" id="accuracyDisplay">
          正确率: 0%
        </div>
      </div>

      <div class="verb-section">
        <div class="verb-large" id="baseVerb">be</div>
        <div class="hint" id="hint"></div>
        <div class="meaning" id="meaning">是，存在</div>
      </div>

      <div class="verb-selector">
        <select id="verbSelect">
          <option value="all">选择动词练习</option>
        </select>
      </div>

      <!-- 错误单词复习区域 -->
      <div class="error-review-section" id="errorReviewSection" style="display: none;">
        <div class="error-review-header">
          <h3>错误单词复习</h3>
          <span class="error-count" id="errorCount">0个错误单词</span>
        </div>
        <div class="error-words-list" id="errorWordsList">
          <!-- 错误单词列表将在这里动态生成 -->
        </div>
        <div class="error-review-controls">
          <button id="startReviewBtn" class="primary">开始复习</button>
          <button id="clearErrorsBtn" class="secondary">清空错误记录</button>
          <button id="backToNormalBtn" class="secondary">返回正常模式</button>
        </div>
      </div>

      <div class="input-group">
        <label class="input-label">过去式 (Past Simple)</label>
        <input id="pastInput" type="text" class="input-field" autocomplete="off" autocapitalize="none" autocorrect="off" placeholder="请输入过去式">
      </div>

      <div class="input-group">
        <label class="input-label">过去分词 (Past Participle)</label>
        <input id="ppInput" type="text" class="input-field" autocomplete="off" autocapitalize="none" autocorrect="off" placeholder="请输入过去分词">
      </div>

      <div class="controls">
        <button id="checkBtn" class="primary">检查答案</button>
        <button class="secondary" id="nextBtn">下一个</button>
        <button class="secondary" id="showBtn">显示答案</button>
        <button class="secondary" id="shuffleBtn">随机顺序</button>
        <button class="secondary" id="reviewBtn">错误复习</button>
      </div>

      <div class="status">
        <div class="status-dot" id="dot" style="background: var(--accent);"></div>
        <div class="status-message" id="message">等待输入 → 输入后点击"检查答案"或按回车</div>
      </div>

      <div class="progress-bar" aria-hidden="true">
        <div class="progress-fill" id="prog" style="width:0%"></div>
      </div>
    </div>

    <footer class="footer">
      <p>© 2025 范先访 | 不规则动词练习工具</p>
    </footer>
  </div>

  <script>
    // 自适应功能
    function initAdaptiveFeatures() {
      // 检测设备类型
      const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      const isTablet = /iPad|Android/i.test(navigator.userAgent) && window.innerWidth >= 768;
      
      // 根据设备类型调整字体大小
      if (isMobile) {
        document.documentElement.style.fontSize = '14px';
      } else if (isTablet) {
        document.documentElement.style.fontSize = '16px';
      } else {
        document.documentElement.style.fontSize = '18px';
      }
      
      // 检测触摸设备
      if ('ontouchstart' in window) {
        document.body.classList.add('touch-device');
      }
      
      // 检测屏幕方向变化
      window.addEventListener('orientationchange', () => {
        setTimeout(() => {
          // 重新计算布局
          window.dispatchEvent(new Event('resize'));
        }, 100);
      });
      
      // 检测窗口大小变化
      let resizeTimer;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => {
          // 重新计算进度条
          updateProgress();
          // 调整字体大小
          adjustFontSize();
          // 检查内容是否适合屏幕
          checkContentFit();
        }, 250);
      });
      
      // 初始调整字体大小
      adjustFontSize();

      // 检测系统偏好设置
      detectSystemPreferences();
      
      // 优化触摸体验
      optimizeTouchExperience();
    }
    
    // 检测系统偏好设置
    function detectSystemPreferences() {
      // 检测是否支持深色模式
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark-mode');
      }
      
      // 检测是否减少动画
      if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        document.body.classList.add('reduced-motion');
      }
      
      // 检测高对比度模式
      if (window.matchMedia && window.matchMedia('(prefers-contrast: high)').matches) {
        document.body.classList.add('high-contrast');
      }
    }
    
    // 优化触摸体验
    function optimizeTouchExperience() {
      if ('ontouchstart' in window) {
        // 防止双击缩放
        let lastTouchEnd = 0;
        document.addEventListener('touchend', (event) => {
          const now = (new Date()).getTime();
          if (now - lastTouchEnd <= 300) {
            event.preventDefault();
          }
          lastTouchEnd = now;
        }, false);
        
        // 优化触摸反馈
        const touchElements = document.querySelectorAll('button, .input-field, select');
        touchElements.forEach(element => {
          element.addEventListener('touchstart', () => {
            element.style.transform = 'scale(0.98)';
          });
          
          element.addEventListener('touchend', () => {
            element.style.transform = '';
          });
        });
      }
    }
    
    // 动态调整字体大小
    function adjustFontSize() {
      const viewportWidth = window.innerWidth;
      const viewportHeight = window.innerHeight;
      
      // 根据视口大小调整字体
      if (viewportWidth < 480) {
        document.documentElement.style.fontSize = '14px';
      } else if (viewportWidth < 768) {
        document.documentElement.style.fontSize = '16px';
      } else if (viewportWidth < 1200) {
        document.documentElement.style.fontSize = '18px';
      } else {
        document.documentElement.style.fontSize = '20px';
      }
      
      // 根据视口高度调整布局模式
      if (viewportHeight < 600) {
        document.body.classList.add('compact-layout');
        document.body.classList.remove('ultra-compact');
      } else if (viewportHeight < 700) {
        document.body.classList.add('ultra-compact');
        document.body.classList.remove('compact-layout');
      } else {
        document.body.classList.remove('compact-layout', 'ultra-compact');
      }
      
      // 特殊处理：如果屏幕高度小于500px，强制使用超紧凑模式
      if (viewportHeight < 500) {
        document.body.classList.add('ultra-compact');
        document.body.classList.remove('compact-layout');
      }
    }

    // 检测内容是否超出屏幕并自动调整
    function checkContentFit() {
      const card = document.getElementById('card');
      const cardHeight = card.offsetHeight;
      const viewportHeight = window.innerHeight;
      const availableHeight = viewportHeight - 40; // 减去一些边距
      
      // 如果内容高度超出可用高度，应用超紧凑模式
      if (cardHeight > availableHeight) {
        document.body.classList.add('ultra-compact');
        document.body.classList.remove('compact-layout');
        
        // 重新检查是否还需要进一步压缩
        setTimeout(() => {
          const newCardHeight = card.offsetHeight;
          if (newCardHeight > availableHeight) {
            // 如果还是超出，添加额外的内联样式来进一步压缩
            card.style.padding = '8px';
            card.style.margin = '0';
            
            // 压缩各个元素
            const verbSection = document.querySelector('.verb-section');
            if (verbSection) {
              verbSection.style.padding = '8px';
              verbSection.style.margin = '8px 0';
            }
            
            const progressInfo = document.querySelector('.progress-info');
            if (progressInfo) {
              progressInfo.style.gap = '4px';
              progressInfo.style.marginBottom = '6px';
            }
            
            const controls = document.querySelector('.controls');
            if (controls) {
              controls.style.gap = '4px';
              controls.style.marginTop = '8px';
            }
            
            const status = document.querySelector('.status');
            if (status) {
              status.style.padding = '6px';
              status.style.marginTop = '8px';
            }
          }
        }, 100);
      }
    }

    const verbs = [
      {base:'be', past:'was/were', pp:'been', meaning:'是，存在'},
      {base:'have', past:'had', pp:'had', meaning:'有'},
      {base:'do', past:'did', pp:'done', meaning:'做'},
      {base:'say', past:'said', pp:'said', meaning:'说'},
      {base:'go', past:'went', pp:'gone', meaning:'去'},
      {base:'get', past:'got', pp:'got/gotten', meaning:'得到'},
      {base:'make', past:'made', pp:'made', meaning:'制造'},
      {base:'know', past:'knew', pp:'known', meaning:'知道'},
      {base:'think', past:'thought', pp:'thought', meaning:'想'},
      {base:'take', past:'took', pp:'taken', meaning:'拿'},
      {base:'see', past:'saw', pp:'seen', meaning:'看见'},
      {base:'come', past:'came', pp:'come', meaning:'来'},
      {base:'find', past:'found', pp:'found', meaning:'找到'},
      {base:'give', past:'gave', pp:'given', meaning:'给'},
      {base:'tell', past:'told', pp:'told', meaning:'告诉'},
      {base:'become', past:'became', pp:'become', meaning:'变成'},
      {base:'show', past:'showed', pp:'shown', meaning:'显示'},
      {base:'leave', past:'left', pp:'left', meaning:'离开'},
      {base:'feel', past:'felt', pp:'felt', meaning:'感觉'},
      {base:'put', past:'put', pp:'put', meaning:'放'},
      {base:'bring', past:'brought', pp:'brought', meaning:'带来'},
      {base:'begin', past:'began', pp:'begun', meaning:'开始'},
      {base:'keep', past:'kept', pp:'kept', meaning:'保持'},
      {base:'hold', past:'held', pp:'held', meaning:'握住'},
      {base:'write', past:'wrote', pp:'written', meaning:'写'},
      {base:'stand', past:'stood', pp:'stood', meaning:'站立'},
      {base:'hear', past:'heard', pp:'heard', meaning:'听见'},
      {base:'let', past:'let', pp:'let', meaning:'让'},
      {base:'mean', past:'meant', pp:'meant', meaning:'意味着'},
      {base:'set', past:'set', pp:'set', meaning:'设置'},
      {base:'meet', past:'met', pp:'met', meaning:'遇见'},
      {base:'run', past:'ran', pp:'run', meaning:'跑'},
      {base:'pay', past:'paid', pp:'paid', meaning:'支付'},
      {base:'sit', past:'sat', pp:'sat', meaning:'坐'},
      {base:'speak', past:'spoke', pp:'spoken', meaning:'说话'},
      {base:'lie', past:'lay', pp:'lain', meaning:'躺'},
      {base:'lead', past:'led', pp:'led', meaning:'领导'},
      {base:'read', past:'read', pp:'read', meaning:'读'},
      {base:'grow', past:'grew', pp:'grown', meaning:'生长'},
      {base:'lose', past:'lost', pp:'lost', meaning:'失去'},
      {base:'fall', past:'fell', pp:'fallen', meaning:'落下'},
      {base:'send', past:'sent', pp:'sent', meaning:'发送'},
      {base:'build', past:'built', pp:'built', meaning:'建造'},
      {base:'understand', past:'understood', pp:'understood', meaning:'理解'},
      {base:'draw', past:'drew', pp:'drawn', meaning:'画'},
      {base:'choose', past:'chose', pp:'chosen', meaning:'选择'},
      {base:'spend', past:'spent', pp:'spent', meaning:'花费'},
      {base:'cut', past:'cut', pp:'cut', meaning:'切'},
      {base:'rise', past:'rose', pp:'risen', meaning:'上升'},
      {base:'drive', past:'drove', pp:'driven', meaning:'驾驶'},
      {base:'buy', past:'bought', pp:'bought', meaning:'买'},
      {base:'wear', past:'wore', pp:'worn', meaning:'穿'},
      {base:'eat', past:'ate', pp:'eaten', meaning:'吃'},
      {base:'drink', past:'drank', pp:'drunk', meaning:'喝'},
      {base:'sleep', past:'slept', pp:'slept', meaning:'睡觉'},
      {base:'sing', past:'sang', pp:'sung', meaning:'唱歌'},
      {base:'swim', past:'swam', pp:'swum', meaning:'游泳'},
      {base:'break', past:'broke', pp:'broken', meaning:'打破'},
      {base:'catch', past:'caught', pp:'caught', meaning:'抓住'},
      {base:'fight', past:'fought', pp:'fought', meaning:'战斗'},
      {base:'teach', past:'taught', pp:'taught', meaning:'教'},
      {base:'sell', past:'sold', pp:'sold', meaning:'卖'},
      {base:'forget', past:'forgot', pp:'forgotten', meaning:'忘记'},
      {base:'win', past:'won', pp:'won', meaning:'赢'},
      {base:'ring', past:'rang', pp:'rung', meaning:'响铃'},
      {base:'bite', past:'bit', pp:'bitten', meaning:'咬'},
      {base:'hide', past:'hid', pp:'hidden', meaning:'隐藏'},
      {base:'strike', past:'struck', pp:'struck', meaning:'打击'},
      {base:'shake', past:'shook', pp:'shaken', meaning:'摇动'},
      {base:'stick', past:'stuck', pp:'stuck', meaning:'粘住'},
      {base:'shoot', past:'shot', pp:'shot', meaning:'射击'},
      {base:'shut', past:'shut', pp:'shut', meaning:'关闭'},
      {base:'hang', past:'hung', pp:'hung', meaning:'悬挂'},
      {base:'light', past:'lit', pp:'lit', meaning:'点亮'},
      {base:'lend', past:'lent', pp:'lent', meaning:'借出'},
      {base:'shine', past:'shone', pp:'shone', meaning:'发光'},
      {base:'swing', past:'swung', pp:'swung', meaning:'摇摆'},
      {base:'deal', past:'dealt', pp:'dealt', meaning:'处理'},
      {base:'bet', past:'bet', pp:'bet', meaning:'打赌'},
      {base:'cost', past:'cost', pp:'cost', meaning:'花费'},
      {base:'fit', past:'fit', pp:'fit', meaning:'适合'},
      {base:'hit', past:'hit', pp:'hit', meaning:'打'},
      {base:'hurt', past:'hurt', pp:'hurt', meaning:'伤害'},
      {base:'quit', past:'quit', pp:'quit', meaning:'退出'},
      {base:'split', past:'split', pp:'split', meaning:'分裂'},
      {base:'broadcast', past:'broadcast', pp:'broadcast', meaning:'广播'},
      {base:'forgive', past:'forgave', pp:'forgiven', meaning:'原谅'},
      {base:'freeze', past:'froze', pp:'frozen', meaning:'冻结'},
      {base:'tear', past:'tore', pp:'torn', meaning:'撕破'},
      {base:'steal', past:'stole', pp:'stolen', meaning:'偷'},
      {base:'blow', past:'blew', pp:'blown', meaning:'吹'},
      {base:'fly', past:'flew', pp:'flown', meaning:'飞'},
      {base:'bear', past:'bore', pp:'borne/born', meaning:'承受'},
      {base:'swear', past:'swore', pp:'sworn', meaning:'发誓'},
      {base:'lay', past:'laid', pp:'laid', meaning:'放置'},
      {base:'dig', past:'dug', pp:'dug', meaning:'挖'},
      {base:'bleed', past:'bled', pp:'bled', meaning:'流血'},
      {base:'bind', past:'bound', pp:'bound', meaning:'绑'},
      {base:'slide', past:'slid', pp:'slid', meaning:'滑动'},
      {base:'spread', past:'spread', pp:'spread', meaning:'传播'},
      {base:'overcome', past:'overcame', pp:'overcome', meaning:'克服'},
      {base:'arise', past:'arose', pp:'arisen', meaning:'出现'},
      {base:'awake', past:'awoke', pp:'awoken', meaning:'醒来'},
      {base:'beat', past:'beat', pp:'beaten', meaning:'打'},
      {base:'bend', past:'bent', pp:'bent', meaning:'弯曲'},
      {base:'breed', past:'bred', pp:'bred', meaning:'繁殖'},
      {base:'cling', past:'clung', pp:'clung', meaning:'粘附'},
      {base:'creep', past:'crept', pp:'crept', meaning:'爬行'},
      {base:'flee', past:'fled', pp:'fled', meaning:'逃跑'},
      {base:'fling', past:'flung', pp:'flung', meaning:'投掷'},
      {base:'grind', past:'ground', pp:'ground', meaning:'磨碎'},
      {base:'kneel', past:'knelt', pp:'knelt', meaning:'跪下'},
      {base:'leap', past:'leapt', pp:'leapt', meaning:'跳跃'},
      {base:'rid', past:'rid', pp:'rid', meaning:'摆脱'},
      {base:'seek', past:'sought', pp:'sought', meaning:'寻找'},
      {base:'sew', past:'sewed', pp:'sewn/sewed', meaning:'缝'},
      {base:'shrink', past:'shrank', pp:'shrunk', meaning:'收缩'},
      {base:'sink', past:'sank', pp:'sunk', meaning:'下沉'},
      {base:'smell', past:'smelt', pp:'smelt', meaning:'闻'},
      {base:'spell', past:'spelt', pp:'spelt', meaning:'拼写'},
      {base:'spin', past:'spun', pp:'spun', meaning:'旋转'},
      {base:'spit', past:'spat', pp:'spat', meaning:'吐痰'},
      {base:'spring', past:'sprang', pp:'sprung', meaning:'跳跃'},
      {base:'sting', past:'stung', pp:'stung', meaning:'刺痛'},
      {base:'stink', past:'stank', pp:'stunk', meaning:'发臭'},
      {base:'stride', past:'strode', pp:'stridden', meaning:'大步走'},
      {base:'string', past:'strung', pp:'strung', meaning:'串起'},
      {base:'strive', past:'strove', pp:'striven', meaning:'努力'},
      {base:'sweep', past:'swept', pp:'swept', meaning:'打扫'},
      {base:'weep', past:'wept', pp:'wept', meaning:'哭泣'},
      {base:'wring', past:'wrung', pp:'wrung', meaning:'拧'},
      {base:'withdraw', past:'withdrew', pp:'withdrawn', meaning:'撤回'},
      {base:'withstand', past:'withstood', pp:'withstood', meaning:'承受'},
      {base:'upset', past:'upset', pp:'upset', meaning:'使心烦'},
      {base:'forecast', past:'forecast', pp:'forecast', meaning:'预报'},
      {base:'interweave', past:'interwove', pp:'interwoven', meaning:'交织'},
      {base:'mislead', past:'misled', pp:'misled', meaning:'误导'},
      {base:'mistake', past:'mistook', pp:'mistaken', meaning:'误解'},
      {base:'overtake', past:'overtook', pp:'overtaken', meaning:'超过'},
      {base:'rebuild', past:'rebuilt', pp:'rebuilt', meaning:'重建'},
      {base:'remake', past:'remade', pp:'remade', meaning:'重做'},
      {base:'repay', past:'repaid', pp:'repaid', meaning:'偿还'},
      {base:'retell', past:'retold', pp:'retold', meaning:'重述'},
      {base:'rewrite', past:'rewrote', pp:'rewritten', meaning:'重写'},
      {base:'undertake', past:'undertook', pp:'undertaken', meaning:'承担'}
    ];

    let order = Array.from({length: verbs.length}, (_,i)=>i);
    let idx = 0;
    let correctCount = 0;
    let wrongCount = 0;
    let totalAttempts = 0;

    const baseEl = document.getElementById('baseVerb');
    const indexEl = document.getElementById('index');
    const pastInput = document.getElementById('pastInput');
    const ppInput = document.getElementById('ppInput');
    const checkBtn = document.getElementById('checkBtn');
    const nextBtn = document.getElementById('nextBtn');
    const showBtn = document.getElementById('showBtn');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const message = document.getElementById('message');
    const dot = document.getElementById('dot');
    const prog = document.getElementById('prog');
    const correctCountEl = document.getElementById('correctCount');
    const wrongCountEl = document.getElementById('wrongCount');
    const meaningEl = document.getElementById('meaning');
    const verbSelect = document.getElementById('verbSelect');
    const accuracyDisplay = document.getElementById('accuracyDisplay');
    const reviewBtn = document.getElementById('reviewBtn');
    const errorReviewSection = document.getElementById('errorReviewSection');
    const errorWordsList = document.getElementById('errorWordsList');
    const errorCount = document.getElementById('errorCount');
    const startReviewBtn = document.getElementById('startReviewBtn');
    const clearErrorsBtn = document.getElementById('clearErrorsBtn');
    const backToNormalBtn = document.getElementById('backToNormalBtn');

    // 错误单词管理
    let errorWords = [];
    let isReviewMode = false;
    let reviewIndex = 0;

    // 从localStorage加载错误单词
    function loadErrorWords() {
      const saved = localStorage.getItem('irregularVerbsErrors');
      if (saved) {
        errorWords = JSON.parse(saved);
        updateErrorDisplay();
      }
    }

    // 保存错误单词到localStorage
    function saveErrorWords() {
      localStorage.setItem('irregularVerbsErrors', JSON.stringify(errorWords));
    }

    // 添加错误单词
    function addErrorWord(verb) {
      const existingIndex = errorWords.findIndex(item => item.base === verb.base);
      if (existingIndex === -1) {
        errorWords.push({
          base: verb.base,
          past: verb.past,
          pp: verb.pp,
          meaning: verb.meaning,
          timestamp: Date.now()
        });
        saveErrorWords();
        updateErrorDisplay();
      }
    }

    // 移除错误单词
    function removeErrorWord(base) {
      errorWords = errorWords.filter(item => item.base !== base);
      saveErrorWords();
      updateErrorDisplay();
    }

    // 更新错误显示
    function updateErrorDisplay() {
      errorCount.textContent = `${errorWords.length}个错误单词`;
      
      if (errorWords.length === 0) {
        errorReviewSection.style.display = 'none';
        return;
      }
      
      // 生成错误单词列表
      errorWordsList.innerHTML = '';
      errorWords.forEach(word => {
        const wordItem = document.createElement('div');
        wordItem.className = 'error-word-item';
        wordItem.innerHTML = `
          <div class="error-word-info">
            <div class="error-word-base">${word.base}</div>
            <div class="error-word-meaning">${word.meaning}</div>
          </div>
          <button class="error-word-remove" onclick="removeErrorWord('${word.base}')">移除</button>
        `;
        errorWordsList.appendChild(wordItem);
      });
    }

    // 开始复习模式
    function startReviewMode() {
      if (errorWords.length === 0) {
        alert('没有错误单词需要复习！');
        return;
      }
      
      isReviewMode = true;
      reviewIndex = 0;
      errorReviewSection.style.display = 'none';
      
      // 切换到第一个错误单词
      const firstError = errorWords[0];
      const verbIndex = verbs.findIndex(v => v.base === firstError.base);
      if (verbIndex !== -1) {
        idx = verbIndex;
        render();
        message.textContent = '复习模式：请回答这个错误单词';
        dot.style.background = '#fbbf24';
      }
    }

    // 退出复习模式
    function exitReviewMode() {
      isReviewMode = false;
      reviewIndex = 0;
      errorReviewSection.style.display = 'none'; // 隐藏整个错误复习区域
      message.textContent = '等待输入 → 输入后点击"检查答案"或按回车';
      dot.style.background = '#fbbf24';
    }

    // 清空错误记录
    function clearErrorWords() {
      if (confirm('确定要清空所有错误记录吗？此操作不可恢复。')) {
        errorWords = [];
        saveErrorWords();
        updateErrorDisplay();
        if (isReviewMode) {
          exitReviewMode();
        }
      }
    }

    // 动态生成动词选择器选项
    verbs.forEach((v,i)=>{
      const option = document.createElement('option');
      option.value=i; 
      option.textContent=v.base+' - '+v.meaning;
      verbSelect.appendChild(option);
    });

    verbSelect.addEventListener('change',()=>{
      const val = verbSelect.value;
      if(val==='all') idx=0; else idx=parseInt(val);
      render();
    });

    function updateAccuracy() {
      const accuracy = totalAttempts > 0 ? Math.round((correctCount / totalAttempts) * 100) : 0;
      accuracyDisplay.textContent = `正确率: ${accuracy}%`;
      
      // 根据正确率设置颜色
      if (accuracy >= 0 && accuracy <= 50) {
        accuracyDisplay.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
      } else if (accuracy >= 51 && accuracy <= 80) {
        accuracyDisplay.style.background = 'linear-gradient(135deg, #f97316, #ea580c)';
      } else if (accuracy >= 81 && accuracy <= 100) {
        accuracyDisplay.style.background = 'linear-gradient(135deg, #10b981, #059669)';
      }
    }

    function render(){
      const i = order[idx];
      const v = verbs[i];
      baseEl.textContent = v.base;
      meaningEl.textContent = v.meaning;
      indexEl.textContent = idx + 1;
      
      // 确保动词选择器显示当前选中的动词
      if (verbSelect.value !== 'all') {
        verbSelect.value = i.toString();
      }
      
      pastInput.value = '';
      ppInput.value = '';
      pastInput.className = 'input-field';
      ppInput.className = 'input-field';
      message.textContent = '等待输入 → 输入后点击"检查答案"或按回车';
      dot.style.background = '#fbbf24';
      updateProgress();
      pastInput.focus();
    }

    function normalize(s){return (s||'').trim().toLowerCase();}
    
    function acceptedAnswers(text){
      // 处理多种答案格式：
      // 1. 斜杠分隔: "was/were" -> ["was", "were"]
      // 2. 空格分隔: "was were" -> ["was", "were"] 
      // 3. 逗号分隔: "was,were" -> ["was", "were"]
      // 4. 单个答案: "was" -> ["was"]
      
      // 支持多种分隔符：斜杠、空格、逗号、分号
      const separators = ['/', ' ', ',', ';'];
      
      // 首先按斜杠分割（最常见的格式）
      let answers = text.split('/').map(x => x.trim().toLowerCase());
      
      // 然后处理每个答案中可能包含的其他分隔符
      let finalAnswers = [];
      answers.forEach(answer => {
        // 检查是否包含其他分隔符
        let hasOtherSeparator = false;
        separators.forEach(sep => {
          if (answer.includes(sep)) {
            hasOtherSeparator = true;
            finalAnswers.push(...answer.split(sep).map(x => x.trim().toLowerCase()));
          }
        });
        
        // 如果没有其他分隔符，直接添加
        if (!hasOtherSeparator) {
          finalAnswers.push(answer);
        }
      });
      
      // 去重并过滤空字符串
      return [...new Set(finalAnswers)].filter(x => x.length > 0);
    }

    function check(){
      const i = order[idx];
      const v = verbs[i];
      const userPast = normalize(pastInput.value);
      const userPP = normalize(ppInput.value);
      const pastOpts = acceptedAnswers(v.past);
      const ppOpts = acceptedAnswers(v.pp);
      
      // 检查用户输入是否包含分隔符，如果包含则也处理用户输入
      const userPastOptions = acceptedAnswers(userPast);
      const userPPOptions = acceptedAnswers(userPP);
      
      // 检查用户答案是否与正确答案匹配
      const pastOK = pastOpts.includes(userPast) || 
                     userPastOptions.some(userAns => pastOpts.includes(userAns));
      const ppOK = ppOpts.includes(userPP) || 
                   userPPOptions.some(userAns => ppOpts.includes(userAns));
      
      pastInput.className = pastOK? 'input-field ok' : 'input-field bad';
      ppInput.className = ppOK? 'input-field ok' : 'input-field bad';
      
      totalAttempts++;
      
      if(pastOK && ppOK){
        message.textContent = '回答正确 🎉🎉🎉';
        dot.style.background = 'var(--ok)';
        correctCount += 1;
        correctCountEl.textContent = correctCount;
        
        // 如果答对了，从错误单词列表中移除
        if (isReviewMode) {
          removeErrorWord(v.base);
          if (errorWords.length === 0) {
            // 所有错误单词都复习完了
            setTimeout(() => {
              alert('恭喜！所有错误单词都复习完成了！🎊');
              exitReviewMode();
            }, 500);
          } else {
            // 继续复习下一个错误单词
            setTimeout(() => {
              reviewIndex++;
              const nextError = errorWords[reviewIndex % errorWords.length];
              const verbIndex = verbs.findIndex(verb => verb.base === nextError.base);
              if (verbIndex !== -1) {
                idx = verbIndex;
                render();
                message.textContent = `复习模式：请回答这个错误单词 (${reviewIndex + 1}/${errorWords.length})`;
              }
            }, 800);
          }
        } else {
          // 正常模式，自动进入下一个
          setTimeout(()=>{ next(false); }, 800);
        }
        
        updateAccuracy();
      } else {
        message.textContent = '有错误，请检查红色框或点击"显示答案"查看正确答案';
        dot.style.background = 'var(--bad)';
        wrongCount += 1;
        wrongCountEl.textContent = wrongCount;
        updateAccuracy();
        addErrorWord(v); // 添加错误单词
      }
    }

    function next(forceShuffleIfEnd=true){
      idx++; 
      if(idx>=order.length){
        message.textContent='练习完成！🎊 点击"随机顺序"再次开始或点击"下一个"重新开始。';
        dot.style.background='var(--muted)';
        idx=0; 
        correctCount=0; 
        wrongCount=0;
        correctCountEl.textContent=correctCount;
        wrongCountEl.textContent=wrongCount;
        if(forceShuffleIfEnd) shuffleOrder();
      }
      render();
    }

    function showAnswer(){
      const i = order[idx]; 
      const v = verbs[i];
      pastInput.value = v.past; 
      ppInput.value = v.pp;
      pastInput.className = 'input-field ok'; 
      ppInput.className='input-field ok';
      message.textContent = '已显示答案'; 
      dot.style.background='var(--accent)';
    }

    function shuffleOrder(){
      for(let i=order.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1)); 
        [order[i],order[j]]=[order[j],order[i]];
      }
      idx=0; 
      correctCount=0; 
      wrongCount=0;
      correctCountEl.textContent=correctCount;
      wrongCountEl.textContent=wrongCount;
      totalAttempts = 0;
      updateAccuracy();
      render();
    }

    function updateProgress(){
      const percent=Math.round((idx/order.length)*100); 
      prog.style.width=percent+'%';
    }

    // 事件监听器
    checkBtn.addEventListener('click', check);
    nextBtn.addEventListener('click', ()=>next(true));
    showBtn.addEventListener('click', showAnswer);
    shuffleBtn.addEventListener('click', ()=>{ 
      shuffleOrder(); 
      message.textContent='已随机打乱顺序 🔀'; 
    });
    reviewBtn.addEventListener('click', ()=>{
      if (errorWords.length === 0) {
        alert('没有错误单词需要复习！');
        return;
      }
      errorReviewSection.style.display = 'block';
    });
    startReviewBtn.addEventListener('click', startReviewMode);
    clearErrorsBtn.addEventListener('click', clearErrorWords);
    backToNormalBtn.addEventListener('click', exitReviewMode);
    
    [pastInput, ppInput].forEach(inp=>{
      inp.addEventListener('keydown',(e)=>{
        if(e.key==='Enter'){
          check();
        }
      });
    });
    
    // 键盘导航优化
    document.addEventListener('keydown', (e) => {
      // 防止在输入框中触发全局快捷键
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') {
        return;
      }
      
      switch(e.key) {
        case ' ': // 空格键 - 检查答案
          e.preventDefault();
          check();
          break;
        case 'ArrowRight': // 右箭头 - 下一个
        case 'n':
        case 'N':
          e.preventDefault();
          next(true);
          break;
        case 'ArrowLeft': // 左箭头 - 显示答案
        case 's':
        case 'S':
          e.preventDefault();
          showAnswer();
          break;
        case 'r':
        case 'R': // R键 - 随机顺序
          e.preventDefault();
          shuffleOrder();
          message.textContent='已随机打乱顺序 🔀';
          break;
        case 'Escape': // ESC键 - 清空输入
          e.preventDefault();
          pastInput.value = '';
          ppInput.value = '';
          pastInput.focus();
          break;
      }
    });

    // 初始化
    render();
    updateAccuracy();
    initAdaptiveFeatures(); // 调用自适应功能
    loadErrorWords(); // 加载错误单词
    
    // 如果有错误单词，显示复习区域
    if (errorWords.length > 0) {
      errorReviewSection.style.display = 'block';
    }
    
    // 延迟检查内容是否适合屏幕
    setTimeout(() => {
      checkContentFit();
    }, 100);
    
    // 保持屏幕唤醒（如果支持）
    if('wakeLock' in navigator){
      try{
        navigator.wakeLock.request('screen');
      }catch(e){}
    }
  </script>
</body>
</html>